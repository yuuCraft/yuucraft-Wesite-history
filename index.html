<!doctype html>
<html lang="ja" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ゆーくらBenchmark</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Noto Sans JP', sans-serif;
    }
    
    .gradient-orange {
      background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
    }
    
    .gradient-blue {
      background: linear-gradient(135deg, #4a90e2 0%, #5ca9fb 100%);
    }
    
    .gradient-purple {
      background: linear-gradient(135deg, #b24592 0%, #f15f79 100%);
    }
    
    .gradient-green {
      background: linear-gradient(135deg, #38b2ac 0%, #4fd1c5 100%);
    }
    
    .score-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
    }
    
    .test-running {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }
    
    @keyframes progress-fill {
      0% { width: 0%; }
    }
    
    .progress-bar-animated {
      animation: progress-fill 0.8s ease-out forwards;
    }
    
    @keyframes pulse-glow {
      0%, 100% {
        box-shadow: 0 0 20px rgba(255, 107, 53, 0.4);
      }
      50% {
        box-shadow: 0 0 40px rgba(255, 107, 53, 0.8);
      }
    }
    
    .pulse-glow {
      animation: pulse-glow 2s ease-in-out infinite;
    }
    
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .rotate-animation {
      animation: rotate 2s linear infinite;
    }
    
    .text-shadow-glow {
      text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
    }
    
    .card-shadow {
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    }
    
    @keyframes shimmer {
      0% { background-position: -1000px 0; }
      100% { background-position: 1000px 0; }
    }
    
    .shimmer {
      background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
      background-size: 1000px 100%;
      animation: shimmer 2s infinite;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="h-full w-full overflow-auto" style="background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);"><!-- Start Screen -->
   <div id="startScreen" class="h-full w-full flex flex-col items-center justify-center p-6">
    <div class="text-center max-w-md w-full"><!-- Logo Area -->
     <div class="mb-8">
      <div class="w-32 h-32 mx-auto gradient-orange rounded-3xl flex items-center justify-center mb-6 card-shadow pulse-glow">
       <svg class="w-20 h-20 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
       </svg>
      </div>
      <h1 id="mainTitle" class="text-5xl font-black text-white mb-3 text-shadow-glow">WEB BENCHMARK</h1>
      <p id="versionText" class="text-lg text-gray-400 font-medium">v10.0 Professional</p>
     </div><!-- Info Cards -->
     <div class="space-y-3 mb-8">
      <div class="score-card rounded-2xl p-4 card-shadow">
       <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
         <div class="w-10 h-10 gradient-blue rounded-xl flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
          </svg>
         </div>
         <div class="text-left">
          <div class="text-sm text-gray-600 font-medium">
           CPU性能
          </div>
          <div class="text-xs text-gray-400">
           演算処理・マルチスレッド
          </div>
         </div>
        </div>
        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
       </div>
      </div>
      <div class="score-card rounded-2xl p-4 card-shadow">
       <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
         <div class="w-10 h-10 gradient-purple rounded-xl flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path>
          </svg>
         </div>
         <div class="text-left">
          <div class="text-sm text-gray-600 font-medium">
           GPU性能
          </div>
          <div class="text-xs text-gray-400">
           グラフィックス・レンダリング
          </div>
         </div>
        </div>
        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
       </div>
      </div>
      <div class="score-card rounded-2xl p-4 card-shadow">
       <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
         <div class="w-10 h-10 gradient-green rounded-xl flex items-center justify-center">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path>
          </svg>
         </div>
         <div class="text-left">
          <div class="text-sm text-gray-600 font-medium">
           メモリ・UX
          </div>
          <div class="text-xs text-gray-400">
           RAM管理・UI応答速度
          </div>
         </div>
        </div>
        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
       </div>
      </div>
     </div><!-- Start Button --> <button id="startButton" class="w-full gradient-orange text-white px-8 py-5 rounded-2xl text-xl font-bold hover:opacity-90 transition-all transform hover:scale-105 card-shadow"> ベンチマーク開始 </button>
     <p class="mt-6 text-gray-500 text-sm">測定時間: 約30秒</p>
    </div>
   </div><!-- Testing Screen -->
   <div id="testingScreen" class="hidden h-full w-full flex flex-col p-6">
    <div class="flex-1 flex flex-col max-w-2xl w-full mx-auto"><!-- Progress Header -->
     <div class="mb-6">
      <div class="flex items-center justify-between mb-3">
       <h2 id="currentTestName" class="text-2xl font-bold text-white">初期化中...</h2><span id="testCounter" class="text-lg font-bold text-orange-400">0/8</span>
      </div>
      <div class="bg-gray-800 rounded-full h-3 overflow-hidden">
       <div id="mainProgress" class="gradient-orange h-full rounded-full transition-all duration-300" style="width: 0%"></div>
      </div>
      <p id="testStatusText" class="text-gray-400 text-sm mt-2">準備中...</p>
     </div><!-- Test Visualization Area -->
     <div class="flex-1 flex flex-col">
      <div class="test-running rounded-3xl p-6 flex-1 flex flex-col card-shadow"><!-- Current Score Display -->
       <div class="text-center mb-6">
        <div class="text-6xl font-black text-white mb-2" id="liveScore">
         0
        </div>
        <div class="text-gray-400 text-sm">
         現在のスコア
        </div>
       </div><!-- Canvas for visual tests -->
       <div class="flex-1 bg-gray-900 rounded-2xl overflow-hidden mb-4">
        <canvas id="testCanvas" class="w-full h-full" width="800" height="600"></canvas>
       </div><!-- Live Metrics -->
       <div class="grid grid-cols-3 gap-3">
        <div class="bg-gray-800 rounded-xl p-3 text-center">
         <div id="metric1Value" class="text-2xl font-bold text-blue-400">
          -
         </div>
         <div id="metric1Label" class="text-xs text-gray-500 mt-1">
          待機中
         </div>
        </div>
        <div class="bg-gray-800 rounded-xl p-3 text-center">
         <div id="metric2Value" class="text-2xl font-bold text-purple-400">
          -
         </div>
         <div id="metric2Label" class="text-xs text-gray-500 mt-1">
          待機中
         </div>
        </div>
        <div class="bg-gray-800 rounded-xl p-3 text-center">
         <div id="metric3Value" class="text-2xl font-bold text-green-400">
          -
         </div>
         <div id="metric3Label" class="text-xs text-gray-500 mt-1">
          待機中
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Results Screen -->
   <div id="resultsScreen" class="hidden h-full w-full overflow-auto p-6">
    <div class="max-w-2xl mx-auto"><!-- Total Score Card -->
     <div class="gradient-orange rounded-3xl p-8 mb-6 text-center card-shadow">
      <h2 id="resultTitle" class="text-2xl font-bold text-white mb-4">ベンチマークスコア</h2>
      <div id="totalScore" class="text-8xl font-black text-white mb-3 text-shadow-glow">
       0
      </div>
      <div id="scoreRating" class="text-xl font-bold text-white opacity-90">
       評価: -
      </div>
      <div class="mt-4 text-white text-sm opacity-75" id="deviceInfo">
       -
      </div>
     </div><!-- Detailed Scores -->
     <div class="space-y-4 mb-6"><!-- CPU Score -->
      <div class="score-card rounded-2xl p-5 card-shadow">
       <div class="flex items-center justify-between mb-3">
        <div class="flex items-center space-x-3">
         <div class="w-12 h-12 gradient-blue rounded-xl flex items-center justify-center">
          <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
          </svg>
         </div>
         <div>
          <div class="text-lg font-bold text-gray-800">
           CPU性能
          </div>
          <div class="text-xs text-gray-500" id="cpuDetail">
           -
          </div>
         </div>
        </div>
        <div class="text-right">
         <div id="cpuScore" class="text-3xl font-black text-blue-600">
          0
         </div>
        </div>
       </div>
       <div class="bg-gray-200 rounded-full h-2 overflow-hidden">
        <div id="cpuBar" class="gradient-blue h-full rounded-full transition-all duration-1000" style="width: 0%"></div>
       </div>
      </div><!-- GPU Score -->
      <div class="score-card rounded-2xl p-5 card-shadow">
       <div class="flex items-center justify-between mb-3">
        <div class="flex items-center space-x-3">
         <div class="w-12 h-12 gradient-purple rounded-xl flex items-center justify-center">
          <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path>
          </svg>
         </div>
         <div>
          <div class="text-lg font-bold text-gray-800">
           GPU性能
          </div>
          <div class="text-xs text-gray-500" id="gpuDetail">
           -
          </div>
         </div>
        </div>
        <div class="text-right">
         <div id="gpuScore" class="text-3xl font-black text-purple-600">
          0
         </div>
        </div>
       </div>
       <div class="bg-gray-200 rounded-full h-2 overflow-hidden">
        <div id="gpuBar" class="gradient-purple h-full rounded-full transition-all duration-1000" style="width: 0%"></div>
       </div>
      </div><!-- Memory Score -->
      <div class="score-card rounded-2xl p-5 card-shadow">
       <div class="flex items-center justify-between mb-3">
        <div class="flex items-center space-x-3">
         <div class="w-12 h-12 gradient-green rounded-xl flex items-center justify-center">
          <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path>
          </svg>
         </div>
         <div>
          <div class="text-lg font-bold text-gray-800">
           メモリ性能
          </div>
          <div class="text-xs text-gray-500" id="memDetail">
           -
          </div>
         </div>
        </div>
        <div class="text-right">
         <div id="memScore" class="text-3xl font-black text-green-600">
          0
         </div>
        </div>
       </div>
       <div class="bg-gray-200 rounded-full h-2 overflow-hidden">
        <div id="memBar" class="gradient-green h-full rounded-full transition-all duration-1000" style="width: 0%"></div>
       </div>
      </div><!-- UX Score -->
      <div class="score-card rounded-2xl p-5 card-shadow">
       <div class="flex items-center justify-between mb-3">
        <div class="flex items-center space-x-3">
         <div class="w-12 h-12 gradient-orange rounded-xl flex items-center justify-center">
          <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
         </div>
         <div>
          <div class="text-lg font-bold text-gray-800">
           UX性能
          </div>
          <div class="text-xs text-gray-500" id="uxDetail">
           -
          </div>
         </div>
        </div>
        <div class="text-right">
         <div id="uxScore" class="text-3xl font-black text-orange-600">
          0
         </div>
        </div>
       </div>
       <div class="bg-gray-200 rounded-full h-2 overflow-hidden">
        <div id="uxBar" class="gradient-orange h-full rounded-full transition-all duration-1000" style="width: 0%"></div>
       </div>
      </div>
     </div><!-- Retest Button --> <button id="retestButton" class="w-full gradient-orange text-white px-8 py-5 rounded-2xl text-xl font-bold hover:opacity-90 transition-all transform hover:scale-105 card-shadow"> 再テスト </button>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      background_color: '#1a1a2e',
      surface_color: '#ffffff',
      text_color: '#ffffff',
      primary_action_color: '#ff6b35',
      secondary_action_color: '#4a90e2',
      font_family: 'Noto Sans JP',
      font_size: 16,
      main_title: 'WEB BENCHMARK',
      version_text: 'v10.0 Professional',
      start_button: 'ベンチマーク開始',
      result_title: 'ベンチマークスコア',
      retest_button: '再テスト'
    };

    const benchmarkResults = {
      cpu: { score: 0, detail: '' },
      gpu: { score: 0, detail: '' },
      memory: { score: 0, detail: '' },
      ux: { score: 0, detail: '' },
      total: 0
    };

    async function onConfigChange(config) {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const fontFamily = `${customFont}, sans-serif`;

      document.body.style.fontFamily = fontFamily;
      
      document.getElementById('mainTitle').style.fontSize = `${baseSize * 3.125}px`;
      document.getElementById('mainTitle').textContent = config.main_title || defaultConfig.main_title;
      
      document.getElementById('versionText').style.fontSize = `${baseSize * 1.125}px`;
      document.getElementById('versionText').textContent = config.version_text || defaultConfig.version_text;
      
      document.getElementById('startButton').textContent = config.start_button || defaultConfig.start_button;
      document.getElementById('resultTitle').textContent = config.result_title || defaultConfig.result_title;
      document.getElementById('retestButton').textContent = config.retest_button || defaultConfig.retest_button;
      
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      const gradientElements = document.querySelectorAll('.gradient-orange');
      gradientElements.forEach(el => {
        el.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${adjustColor(primaryColor, 20)} 100%)`;
      });
    }

    function adjustColor(color, percent) {
      const num = parseInt(color.replace('#', ''), 16);
      const amt = Math.round(2.55 * percent);
      const R = (num >> 16) + amt;
      const G = (num >> 8 & 0x00FF) + amt;
      const B = (num & 0x0000FF) + amt;
      return '#' + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
        (B < 255 ? B < 1 ? 0 : B : 255))
        .toString(16).slice(1);
    }

    function updateTestProgress(testName, status, current, total) {
      document.getElementById('currentTestName').textContent = testName;
      document.getElementById('testStatusText').textContent = status;
      document.getElementById('testCounter').textContent = `${current}/${total}`;
      document.getElementById('mainProgress').style.width = `${(current / total) * 100}%`;
    }

    function updateLiveMetrics(value1, label1, value2, label2, value3, label3) {
      document.getElementById('metric1Value').textContent = value1;
      document.getElementById('metric1Label').textContent = label1;
      document.getElementById('metric2Value').textContent = value2;
      document.getElementById('metric2Label').textContent = label2;
      document.getElementById('metric3Value').textContent = value3;
      document.getElementById('metric3Label').textContent = label3;
    }

    // CPU Test - 整数演算、浮動小数点演算、暗号化処理
    async function testCPU() {
      updateTestProgress('CPU整数演算', '整数計算性能を測定中...', 1, 8);
      updateLiveMetrics('-', '整数演算', '-', '浮動小数点', '-', '暗号化');
      
      const canvas = document.getElementById('testCanvas');
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#1a1a2e';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Integer operations
      let intScore = 0;
      const intStart = performance.now();
      let result = 0;
      for (let i = 0; i < 10000000; i++) {
        result = (result + i * 13579) % 999999;
        result = (result << 3) | (result >> 2);
        if (i % 500000 === 0) {
          updateLiveMetrics(`${Math.floor(i/10000)}%`, '整数演算', '-', '浮動小数点', '-', '暗号化');
          await new Promise(r => setTimeout(r, 0));
        }
      }
      const intTime = performance.now() - intStart;
      intScore = Math.round(10000000 / intTime * 100);
      
      updateTestProgress('CPU浮動小数点演算', '科学計算性能を測定中...', 2, 8);
      
      // Float operations
      let floatScore = 0;
      const floatStart = performance.now();
      let floatResult = 0.0;
      for (let i = 0; i < 5000000; i++) {
        floatResult += Math.sqrt(i) * Math.sin(i / 1000) * Math.cos(i / 500);
        floatResult = floatResult % 100000;
        if (i % 250000 === 0) {
          updateLiveMetrics(`${intScore.toLocaleString()}`, '整数演算', `${Math.floor(i/50000)}%`, '浮動小数点', '-', '暗号化');
          await new Promise(r => setTimeout(r, 0));
        }
      }
      const floatTime = performance.now() - floatStart;
      floatScore = Math.round(5000000 / floatTime * 100);
      
      updateTestProgress('CPU暗号化処理', '文字列操作とハッシュ演算...', 3, 8);
      
      // Crypto-like operations
      let cryptoScore = 0;
      const cryptoStart = performance.now();
      for (let i = 0; i < 100000; i++) {
        let str = 'benchmark_test_' + i;
        for (let j = 0; j < 10; j++) {
          str = btoa(str).substring(0, 20);
        }
        if (i % 5000 === 0) {
          updateLiveMetrics(`${intScore.toLocaleString()}`, '整数演算', `${floatScore.toLocaleString()}`, '浮動小数点', `${Math.floor(i/1000)}%`, '暗号化');
          await new Promise(r => setTimeout(r, 0));
        }
      }
      const cryptoTime = performance.now() - cryptoStart;
      cryptoScore = Math.round(100000 / cryptoTime * 100);
      
      const totalCpuScore = Math.round((intScore * 0.4 + floatScore * 0.4 + cryptoScore * 0.2));
      benchmarkResults.cpu.score = totalCpuScore;
      benchmarkResults.cpu.detail = `整数: ${intScore.toLocaleString()} / 浮動: ${floatScore.toLocaleString()}`;
      
      updateLiveMetrics(`${intScore.toLocaleString()}`, '整数演算', `${floatScore.toLocaleString()}`, '浮動小数点', `${cryptoScore.toLocaleString()}`, '暗号化');
      document.getElementById('liveScore').textContent = totalCpuScore.toLocaleString();
      
      return totalCpuScore;
    }

    // GPU Test - Canvas 2D, WebGL, Animation
    async function testGPU() {
      updateTestProgress('GPU 2D描画', 'Canvas 2Dレンダリング性能...', 4, 8);
      updateLiveMetrics('-', '2D描画', '-', 'WebGL', '-', 'アニメーション');
      
      const canvas = document.getElementById('testCanvas');
      const ctx = canvas.getContext('2d');
      
      // 2D Canvas test
      const canvas2DStart = performance.now();
      for (let frame = 0; frame < 150; frame++) {
        ctx.fillStyle = '#1a1a2e';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        for (let i = 0; i < 200; i++) {
          const x = Math.sin(frame * 0.05 + i * 0.1) * 300 + canvas.width / 2;
          const y = Math.cos(frame * 0.03 + i * 0.15) * 200 + canvas.height / 2;
          const size = Math.sin(frame * 0.1 + i) * 20 + 30;
          
          const gradient = ctx.createRadialGradient(x, y, 0, x, y, size);
          gradient.addColorStop(0, `hsla(${(frame * 2 + i * 3) % 360}, 70%, 60%, 0.8)`);
          gradient.addColorStop(1, `hsla(${(frame * 2 + i * 3) % 360}, 70%, 30%, 0)`);
          
          ctx.fillStyle = gradient;
          ctx.beginPath();
          ctx.arc(x, y, size, 0, Math.PI * 2);
          ctx.fill();
        }
        
        if (frame % 15 === 0) {
          updateLiveMetrics(`${Math.floor(frame/1.5)}%`, '2D描画', '-', 'WebGL', '-', 'アニメーション');
          await new Promise(r => setTimeout(r, 0));
        }
      }
      const canvas2DTime = performance.now() - canvas2DStart;
      const canvas2DScore = Math.round(150 * 200 / canvas2DTime * 1000);
      
      updateTestProgress('GPU WebGL', 'WebGL 3D性能を測定中...', 5, 8);
      
      // WebGL test
      const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
      let webglScore = 0;
      
      if (gl) {
        const vsSource = `
          attribute vec4 aPosition;
          void main() { gl_Position = aPosition; }
        `;
        const fsSource = `
          precision mediump float;
          uniform vec4 uColor;
          void main() { gl_FragColor = uColor; }
        `;
        
        const vs = gl.createShader(gl.VERTEX_SHADER);
        gl.shaderSource(vs, vsSource);
        gl.compileShader(vs);
        
        const fs = gl.createShader(gl.FRAGMENT_SHADER);
        gl.shaderSource(fs, fsSource);
        gl.compileShader(fs);
        
        const program = gl.createProgram();
        gl.attachShader(program, vs);
        gl.attachShader(program, fs);
        gl.linkProgram(program);
        gl.useProgram(program);
        
        const positionBuffer = gl.createBuffer();
        const colorLocation = gl.getUniformLocation(program, 'uColor');
        
        const webglStart = performance.now();
        for (let i = 0; i < 30000; i++) {
          const x = Math.random() * 2 - 1;
          const y = Math.random() * 2 - 1;
          const size = Math.random() * 0.1;
          
          gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
          gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
            x, y, x + size, y, x, y + size
          ]), gl.STATIC_DRAW);
          
          const posLoc = gl.getAttribLocation(program, 'aPosition');
          gl.enableVertexAttribArray(posLoc);
          gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0);
          
          gl.uniform4f(colorLocation, Math.random(), Math.random(), Math.random(), 1.0);
          gl.drawArrays(gl.TRIANGLES, 0, 3);
          
          if (i % 3000 === 0) {
            updateLiveMetrics(`${canvas2DScore.toLocaleString()}`, '2D描画', `${Math.floor(i/300)}%`, 'WebGL', '-', 'アニメーション');
            await new Promise(r => setTimeout(r, 0));
          }
        }
        const webglTime = performance.now() - webglStart;
        webglScore = Math.round(30000 / webglTime * 1000);
      }
      
      updateTestProgress('GPUアニメーション', 'フレームレート計測中...', 6, 8);
      
      // Animation FPS test
      const fpsTest = await new Promise((resolve) => {
        const frames = [];
        const duration = 2000;
        const startTime = performance.now();
        
        function animate() {
          const currentTime = performance.now();
          frames.push(currentTime);
          
          ctx.fillStyle = '#1a1a2e';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          
          const elapsed = currentTime - startTime;
          for (let i = 0; i < 50; i++) {
            const angle = elapsed * 0.001 + i * 0.2;
            const x = Math.cos(angle) * 200 + canvas.width / 2;
            const y = Math.sin(angle) * 200 + canvas.height / 2;
            
            ctx.fillStyle = `hsl(${(i * 7 + elapsed * 0.1) % 360}, 70%, 60%)`;
            ctx.fillRect(x - 15, y - 15, 30, 30);
          }
          
          if (elapsed < duration) {
            requestAnimationFrame(animate);
          } else {
            const fps = frames.length / (duration / 1000);
            resolve(fps);
          }
        }
        
        requestAnimationFrame(animate);
      });
      
      const fpsScore = Math.round(fpsTest * 100);
      
      const totalGpuScore = Math.round((canvas2DScore * 0.4 + webglScore * 0.4 + fpsScore * 0.2));
      benchmarkResults.gpu.score = totalGpuScore;
      benchmarkResults.gpu.detail = `2D: ${canvas2DScore.toLocaleString()} / 3D: ${webglScore.toLocaleString()} / FPS: ${fpsTest.toFixed(1)}`;
      
      updateLiveMetrics(`${canvas2DScore.toLocaleString()}`, '2D描画', `${webglScore.toLocaleString()}`, 'WebGL', `${fpsTest.toFixed(1)}`, 'FPS');
      document.getElementById('liveScore').textContent = totalGpuScore.toLocaleString();
      
      return totalGpuScore;
    }

    // Memory Test
    async function testMemory() {
      updateTestProgress('メモリ管理', 'RAM読み書き・GC性能測定中...', 7, 8);
      updateLiveMetrics('-', 'アロケーション', '-', 'ソート', '-', 'GC効率');
      
      const canvas = document.getElementById('testCanvas');
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#1a1a2e';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Memory allocation test
      const allocStart = performance.now();
      const arrays = [];
      for (let i = 0; i < 2000; i++) {
        const arr = new Float64Array(30000);
        for (let j = 0; j < 30000; j++) {
          arr[j] = Math.random() * 10000;
        }
        arrays.push(arr);
        
        if (i % 200 === 0) {
          updateLiveMetrics(`${Math.floor(i/20)}%`, 'アロケーション', '-', 'ソート', '-', 'GC効率');
          await new Promise(r => setTimeout(r, 0));
        }
      }
      const allocTime = performance.now() - allocStart;
      const allocScore = Math.round(2000 * 30000 / allocTime * 10);
      
      // Sorting test
      const sortStart = performance.now();
      for (let i = 0; i < 100; i++) {
        const arr = new Array(50000).fill(0).map(() => Math.random() * 10000);
        arr.sort((a, b) => a - b);
        
        if (i % 10 === 0) {
          updateLiveMetrics(`${allocScore.toLocaleString()}`, 'アロケーション', `${i}%`, 'ソート', '-', 'GC効率');
          await new Promise(r => setTimeout(r, 0));
        }
      }
      const sortTime = performance.now() - sortStart;
      const sortScore = Math.round(100 * 50000 / sortTime * 10);
      
      // GC test (create and discard)
      const gcStart = performance.now();
      for (let i = 0; i < 5000; i++) {
        let temp = new Array(10000).fill(0).map((_, idx) => idx * Math.random());
        temp = null;
      }
      const gcTime = performance.now() - gcStart;
      const gcScore = Math.round(5000 * 10000 / gcTime * 10);
      
      const totalMemScore = Math.round((allocScore * 0.4 + sortScore * 0.3 + gcScore * 0.3));
      benchmarkResults.memory.score = totalMemScore;
      benchmarkResults.memory.detail = `確保: ${allocScore.toLocaleString()} / ソート: ${sortScore.toLocaleString()}`;
      
      updateLiveMetrics(`${allocScore.toLocaleString()}`, 'アロケーション', `${sortScore.toLocaleString()}`, 'ソート', `${gcScore.toLocaleString()}`, 'GC効率');
      document.getElementById('liveScore').textContent = totalMemScore.toLocaleString();
      
      return totalMemScore;
    }

    // UX Test - DOM, Storage, Network
    async function testUX() {
      updateTestProgress('UX性能', 'DOM操作・ストレージ・ネットワーク測定中...', 8, 8);
      updateLiveMetrics('-', 'DOM操作', '-', 'Storage', '-', 'Network');
      
      const canvas = document.getElementById('testCanvas');
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = '#1a1a2e';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // DOM manipulation test
      const domStart = performance.now();
      const container = document.createElement('div');
      container.style.position = 'absolute';
      container.style.left = '-10000px';
      document.body.appendChild(container);
      
      for (let i = 0; i < 3000; i++) {
        const el = document.createElement('div');
        el.className = 'test-item';
        el.textContent = `Item ${i}`;
        el.style.width = `${100 + i % 200}px`;
        el.style.height = `${50 + i % 100}px`;
        container.appendChild(el);
        
        if (i % 300 === 0) {
          const computed = window.getComputedStyle(el);
          const w = computed.width;
        }
        
        if (i % 300 === 0) {
          updateLiveMetrics(`${Math.floor(i/30)}%`, 'DOM操作', '-', 'Storage', '-', 'Network');
          await new Promise(r => setTimeout(r, 0));
        }
      }
      
      container.innerHTML = '';
      document.body.removeChild(container);
      const domTime = performance.now() - domStart;
      const domScore = Math.round(3000 / domTime * 10000);
      
      // LocalStorage test
      const storageStart = performance.now();
      for (let i = 0; i < 1000; i++) {
        const key = `test_key_${i}`;
        const value = `test_value_${'x'.repeat(100)}_${i}`;
        localStorage.setItem(key, value);
        const retrieved = localStorage.getItem(key);
        localStorage.removeItem(key);
        
        if (i % 100 === 0) {
          updateLiveMetrics(`${domScore.toLocaleString()}`, 'DOM操作', `${Math.floor(i/10)}%`, 'Storage', '-', 'Network');
          await new Promise(r => setTimeout(r, 0));
        }
      }
      const storageTime = performance.now() - storageStart;
      const storageScore = Math.round(1000 / storageTime * 10000);
      
      // Network test
      const networkStart = performance.now();
      const requests = [];
      for (let i = 0; i < 5; i++) {
        try {
          const reqStart = performance.now();
          await fetch('https://cdn.tailwindcss.com/3.3.0/tailwind.min.css', {
            method: 'HEAD',
            cache: 'no-store'
          });
          const reqTime = performance.now() - reqStart;
          requests.push(reqTime);
        } catch (e) {
          requests.push(1000);
        }
        
        updateLiveMetrics(`${domScore.toLocaleString()}`, 'DOM操作', `${storageScore.toLocaleString()}`, 'Storage', `${i + 1}/5`, 'Network');
        await new Promise(r => setTimeout(r, 100));
      }
      const avgLatency = requests.reduce((a, b) => a + b, 0) / requests.length;
      const networkScore = Math.round((1000 / avgLatency) * 5000);
      
      const totalUxScore = Math.round((domScore * 0.4 + storageScore * 0.3 + networkScore * 0.3));
      benchmarkResults.ux.score = totalUxScore;
      benchmarkResults.ux.detail = `DOM: ${domScore.toLocaleString()} / Latency: ${avgLatency.toFixed(1)}ms`;
      
      updateLiveMetrics(`${domScore.toLocaleString()}`, 'DOM操作', `${storageScore.toLocaleString()}`, 'Storage', `${avgLatency.toFixed(1)}ms`, 'レイテンシー');
      document.getElementById('liveScore').textContent = totalUxScore.toLocaleString();
      
      return totalUxScore;
    }

    async function runFullBenchmark() {
      document.getElementById('startScreen').classList.add('hidden');
      document.getElementById('testingScreen').classList.remove('hidden');
      
      await testCPU();
      await new Promise(r => setTimeout(r, 500));
      
      await testGPU();
      await new Promise(r => setTimeout(r, 500));
      
      await testMemory();
      await new Promise(r => setTimeout(r, 500));
      
      await testUX();
      await new Promise(r => setTimeout(r, 500));
      
      calculateTotalScore();
      displayResults();
    }

    function calculateTotalScore() {
      benchmarkResults.total = Math.round(
        benchmarkResults.cpu.score * 0.30 +
        benchmarkResults.gpu.score * 0.30 +
        benchmarkResults.memory.score * 0.25 +
        benchmarkResults.ux.score * 0.15
      );
    }

    function displayResults() {
      document.getElementById('testingScreen').classList.add('hidden');
      document.getElementById('resultsScreen').classList.remove('hidden');
      
      // Device info
      const userAgent = navigator.userAgent;
      const platform = navigator.platform;
      const cores = navigator.hardwareConcurrency || 'Unknown';
      document.getElementById('deviceInfo').textContent = `${platform} / ${cores} コア / ${userAgent.includes('Mobile') ? 'Mobile' : 'Desktop'}`;
      
      setTimeout(() => {
        document.getElementById('cpuScore').textContent = benchmarkResults.cpu.score.toLocaleString();
        document.getElementById('cpuDetail').textContent = benchmarkResults.cpu.detail;
        document.getElementById('cpuBar').style.width = `${Math.min((benchmarkResults.cpu.score / 500000) * 100, 100)}%`;
      }, 100);
      
      setTimeout(() => {
        document.getElementById('gpuScore').textContent = benchmarkResults.gpu.score.toLocaleString();
        document.getElementById('gpuDetail').textContent = benchmarkResults.gpu.detail;
        document.getElementById('gpuBar').style.width = `${Math.min((benchmarkResults.gpu.score / 500000) * 100, 100)}%`;
      }, 300);
      
      setTimeout(() => {
        document.getElementById('memScore').textContent = benchmarkResults.memory.score.toLocaleString();
        document.getElementById('memDetail').textContent = benchmarkResults.memory.detail;
        document.getElementById('memBar').style.width = `${Math.min((benchmarkResults.memory.score / 500000) * 100, 100)}%`;
      }, 500);
      
      setTimeout(() => {
        document.getElementById('uxScore').textContent = benchmarkResults.ux.score.toLocaleString();
        document.getElementById('uxDetail').textContent = benchmarkResults.ux.detail;
        document.getElementById('uxBar').style.width = `${Math.min((benchmarkResults.ux.score / 500000) * 100, 100)}%`;
      }, 700);
      
      setTimeout(() => {
        document.getElementById('totalScore').textContent = benchmarkResults.total.toLocaleString();
        
        let rating = '';
        if (benchmarkResults.total >= 400000) rating = 'フラッグシップ級';
        else if (benchmarkResults.total >= 300000) rating = 'ハイエンド';
        else if (benchmarkResults.total >= 200000) rating = 'ミッドレンジ+';
        else if (benchmarkResults.total >= 100000) rating = 'ミッドレンジ';
        else if (benchmarkResults.total >= 50000) rating = 'エントリー';
        else rating = 'ベーシック';
        
        document.getElementById('scoreRating').textContent = `評価: ${rating}`;
      }, 1000);
    }

    function resetBenchmark() {
      document.getElementById('resultsScreen').classList.add('hidden');
      document.getElementById('startScreen').classList.remove('hidden');
      
      benchmarkResults.cpu.score = 0;
      benchmarkResults.gpu.score = 0;
      benchmarkResults.memory.score = 0;
      benchmarkResults.ux.score = 0;
      benchmarkResults.total = 0;
      
      document.getElementById('liveScore').textContent = '0';
    }

    document.getElementById('startButton').addEventListener('click', runFullBenchmark);
    document.getElementById('retestButton').addEventListener('click', resetBenchmark);

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.primary_action_color || defaultConfig.primary_action_color,
              set: (value) => {
                config.primary_action_color = value;
                window.elementSdk.setConfig({ primary_action_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ['main_title', config.main_title || defaultConfig.main_title],
          ['version_text', config.version_text || defaultConfig.version_text],
          ['start_button', config.start_button || defaultConfig.start_button],
          ['result_title', config.result_title || defaultConfig.result_title],
          ['retest_button', config.retest_button || defaultConfig.retest_button]
        ])
      });
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c89289071d396a9',t:'MTc3MDE5NzUyMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
